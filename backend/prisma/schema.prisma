generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String   @id @default(cuid())
  name                    String
  email                   String   @unique
  passwordHash            String   @map("password_hash")
  role                    Role
  active                  Boolean  @default(true)
  basicContributionAmount Float?   @map("basic_contribution_amount")
  createdAt               DateTime @default(now()) @map("created_at")

  contributions      Contribution[]
  basicPayments      BasicContributionPayment[]
  submittedExpenses  Expense[] @relation("ExpenseSubmitter")
  approvedExpenses   Expense[] @relation("ExpenseApprover")
}

model Contribution {
  id         String             @id @default(cuid())
  user       User               @relation(fields: [userId], references: [id])
  userId     String
  amount     Float
  date       DateTime
  notes      String?
  type       ContributionType   @default(ADDITIONAL)
  status     ContributionStatus @default(PENDING)
  createdBy  String?            @map("created_by")
  approvedBy String?            @map("approved_by")
  approvedAt DateTime?          @map("approved_at")
  createdAt  DateTime           @default(now()) @map("created_at")
}

model Event {
  id          String   @id @default(cuid())
  name        String
  description String?
  date        DateTime?
  createdAt   DateTime @default(now()) @map("created_at")
  expenses    Expense[]
}

model Expense {
  id          String        @id @default(cuid())
  amount      Float
  vendor      String?
  purpose     String
  description String?
  date        DateTime
  category    String
  eventId     String?
  event       Event?        @relation(fields: [eventId], references: [id], onDelete: SetNull)

  // Approval workflow
  status      ExpenseStatus @default(PENDING)
  submittedBy String?       @map("submitted_by")
  submitter   User?         @relation("ExpenseSubmitter", fields: [submittedBy], references: [id])
  approvedBy  String?       @map("approved_by")
  approver    User?         @relation("ExpenseApprover", fields: [approvedBy], references: [id])
  approvedAt  DateTime?     @map("approved_at")

  createdAt   DateTime      @default(now()) @map("created_at")
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  message   String
  createdAt DateTime @default(now()) @map("created_at")
}

enum Role {
  ADMIN
  ALUMNI
}

enum ContributionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ContributionType {
  BASIC
  ADDITIONAL
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
}

model BasicContributionPayment {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  year      Int
  month     Int
  amount    Float
  paid      Boolean   @default(false)
  paidAt    DateTime? @map("paid_at")
  paidBy    String?   @map("paid_by")
  createdAt DateTime  @default(now()) @map("created_at")

  @@unique([userId, year, month])
  @@map("basic_contribution_payment")
}
